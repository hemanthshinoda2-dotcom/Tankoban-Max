/*
OWNERSHIP (styles):
- Global UI styling for the app
- Video HUD / fullscreen / toast / mpv-mode layout rules live here
- Keep selectors stable; many behaviors depend on specific class hooks on <body>

SECTION INDEX:
  Video Shell & Fullscreen ........... line ~9
  Window Chrome & Utilities .......... line ~164
  Theme Tokens (OLED Cinema) ......... line ~185
  Topbar & Library Controls .......... line ~272
  Sidebar & Folder Tree .............. line ~551
  Global Search ...................... line ~613
  Continue Reading Shelf ............. line ~704
  Series Grid & Tiles ................ line ~842
  Volumes & Episode Table ............ line ~969
  Inside-Series View ................. line ~1060
  Volume Navigator & Overlays ........ line ~1357
  Comic Reader / Player .............. line ~1531
  Toast & Hint ....................... line ~2109
  Context Menu ....................... line ~2127
  End-of-Volume & Mega Settings ...... line ~2172
  HUD Hide & Player Body Rules ....... line ~2391
  Loading Overlay & Spinner .......... line ~2525
  Mode Menu, Loupe & FX .............. line ~2622
  Video Mode (library + player) ...... line ~2774
  Books Mode Stubs ................... line ~3630
*/

/* ══════ SECTION: Video Shell & Fullscreen ══════ */

/* BUILD34: avoid scrollbars in the video shell (fullscreen/windowed). */
body.inVideoPlayer {
  overflow: hidden;
}

/* BUILD37: video shell should be edge-to-edge and never introduce scrollbars (fullscreen/windowed). */
body.videoShellMode {
  overflow: hidden;
}
body.videoShellMode .topbar {
  display: none !important;
}
body.videoShellMode main {
  padding: 0 !important;
  max-width: none !important;
  margin: 0 !important;
  height: 100vh;
}
body.videoShellMode #videoPlayerView {
  position: fixed;
  inset: 0;
  padding: 0 !important;
  margin: 0 !important;
  display: block !important;
  width: 100vw;
  height: 100vh;
}
body.videoShellMode .videoPlayerShell {
  width: 100vw !important;
  height: 100vh !important;
  overflow: hidden;
}
body.videoShellMode .videoStage {
  height: 100% !important;
}

/* Build 54: in-player diagnostics overlay (canvas rendering stats) */
.videoDiagnostics{
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 60;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(0,0,0,0.55);
  border: 1px solid rgba(255,255,255,0.14);
  color: rgba(255,255,255,0.92);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12px;
  line-height: 1.35;
  white-space: pre;
  pointer-events: none;
  max-width: 520px;
}


/* BUILD40A: true fullscreen inside the embedded player.
   Requirements:
   - Video fills the entire window in fullscreen (aspect-ratio bars only when needed).
   - No Tankoban chrome or player control bar in fullscreen.
   - Only two sizes: normal (with control bar) and fullscreen (video only).
*/
body.videoFullscreen {
  overflow: hidden;
}
body.videoFullscreen .topbar {
  display: none !important;
}
body.videoFullscreen main {
  padding: 0 !important;
  max-width: none !important;
  margin: 0 !important;
  height: 100vh;
}
body.videoFullscreen #videoPlayerView {
  position: fixed;
  inset: 0;
  padding: 0 !important;
  margin: 0 !important;
  display: block !important;
  width: 100%;
  height: 100%;
}
body.videoFullscreen .videoPlayerShell {
  width: 100% !important;
  height: 100% !important;
  padding: 0 !important;
  gap: 0 !important;
  overflow: hidden;
}
body.videoFullscreen .videoPlayerBar {
  display: none !important;
}
body.videoFullscreen .videoStage {
  height: 100% !important;
  gap: 0 !important;
}
body.videoFullscreen .mpvHost {
  border-radius: 0 !important;
  width: 100% !important;
  height: 100% !important;
}
:root{
  /* Build 41A — Black/charcoal theme */
  --bg:#070707;
  --bg-rgb: 7,7,7;

  --panel:#0f1012;
  --panel-rgb: 15,16,18;

  --panel2:#151618;
  --panel2-rgb: 21,22,24;

  /* Translucent surfaces (used for sidebar/topbars/HUD) */
  --surface-rgb: 18,18,18;

  --text:#e6e6e6;
  --muted:#a1a1aa;
  --border:rgba(255,255,255,.14);
  --accent:#60a5fa;
  --accent-rgb: 96,165,250;

  /* YAC-style library tokens (Build 1) */
  --lib-font: 11px;
  --lib-line: 1.25;
  --lib-topbar-h: 38px;
  --lib-side-w: 210px;
  --lib-gap: 10px;
  --lib-pad: 8px;
  --lib-radius: 8px;
  --lib-radius-sm: 6px;
  --lib-border: rgba(255,255,255,.10);
  --lib-hover: rgba(255,255,255,.06);
  --lib-select: rgba(var(--accent-rgb),.14);

  /* BUILD19F_TOPBAR_TOKENS (Build 19F)
     INTENT: Library top settings bar becomes a neutral light-grey control strip.
     Scope: These tokens are ONLY consumed by .topbar overrides below. */
  --topbar-bg: #e9eaed;
  --topbar-bg2: #f3f4f6;
  --topbar-text: rgba(20,20,20,.92);
  --topbar-muted: rgba(20,20,20,.62);
  --topbar-border: rgba(0,0,0,.10);
  --topbar-border2: rgba(0,0,0,.14);
  --topbar-shadow: rgba(0,0,0,.16);
}
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);
  color:var(--text);
}

/* ══════ SECTION: Window Chrome & Utilities ══════ */

/* Build 36: standard OS window chrome is enabled; hide redundant in-app window buttons. */
.winChromeHidden{ display:none !important; }

/* -----------------------------
   EDIT_ZONE:LIB_TOKENS
   Build 1 — Library shell + density foundation
   (Scoped to library view; player UI unaffected.)
------------------------------*/

/* Truncation utilities */
.u-ellipsis{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; min-width:0; }
.u-clamp2{
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp:2;
  overflow:hidden;
  line-height: var(--lib-line);
  max-height: calc(2 * 1em * var(--lib-line));
  min-height: calc(2 * 1em * var(--lib-line));
}

/* ══════ SECTION: Theme Tokens (OLED Cinema) ══════ */

/* BUILD 24 — OLED Cinema Library skin (Theme C) */
/* INTENT: Scope theme tokens to the Library UI only (body:not(.inPlayer)) so the Player/Reader colors remain unchanged. */
body:not(.inPlayer){
  --bg: #121212;
  --bg-rgb: 18,18,18;
  --text: #eeeeee;
  --accent: #ff5555;
  --accent-rgb: 255,85,85;
  --surface-rgb: 0,0,0;

  /* Library selection/active highlight */
  --lib-select: rgba(var(--accent-rgb),.14);

  /* Topbar tokens: Build 23A defaulted to a light strip; Theme C keeps it dark. */
  --topbar-bg: #000000;
  --topbar-bg2: #121212;
  --topbar-text: #eeeeee;
  --topbar-muted: rgba(238,238,238,.70);
  --topbar-border: rgba(255,255,255,.10);
  --topbar-border2: rgba(255,255,255,.14);
  --topbar-shadow: rgba(0,0,0,.65);
}

/* Required: Library sidebar is true OLED black. */
body:not(.inPlayer) .libSidebar {
  background: #000000;
}

/* Library topbar controls: dark surfaces with light text; accent color is driven by --accent-rgb above. */
body:not(.inPlayer) .topbar .iconBtn,
body:not(.inPlayer) .topbar .btn-ghost {
  background: rgba(255,255,255,.06);
  border-color: var(--topbar-border2);
  color: var(--topbar-text);
}
body:not(.inPlayer) .topbar .iconBtn:hover,
body:not(.inPlayer) .topbar .btn-ghost:hover {
  background: rgba(255,255,255,.10);
  border-color: rgba(255,255,255,.18);
}

body:not(.inPlayer) #libraryView,
body:not(.inPlayer) #videoLibraryView,
body:not(.inPlayer) #booksLibraryView{
  font-size: var(--lib-font);
  line-height: var(--lib-line);
}

body:not(.inPlayer) main{
  padding: var(--lib-topbar-h) 0 0;
  max-width:none;
  margin:0;
}

body:not(.inPlayer) .view{ gap:0; }

.libraryShell{
  display:grid;
  grid-template-columns: var(--lib-side-w) 1fr;
  min-height: calc(100vh - var(--lib-topbar-h));
  height: calc(100vh - var(--lib-topbar-h));
}

.libSidebar{
  border-right:1px solid var(--lib-border);
  background: rgba(var(--surface-rgb),.40);
  padding: var(--lib-pad);
  overflow:auto;
}

.navSection{ display:flex; flex-direction:column; gap:6px; }
.navHeader{ font-weight:800; font-size: 11px; letter-spacing:.2px; color: rgba(229,231,235,.92); }
.navItems{ display:flex; flex-direction:column; gap:6px; }
.navSep{ height:1px; background: var(--lib-border); margin: 10px 0; }
.navMuted{ color: var(--muted); font-size: 11px; padding: 2px 2px; }
.navHeaderCollapsible{ cursor:pointer; user-select:none; }

.libContent{
  padding: var(--lib-pad);
  display:flex;
  flex-direction:column;
  gap: var(--lib-gap);
  flex: 1;
  min-height: 0;
  overflow:hidden;
}

/* ══════ SECTION: Topbar & Library Controls ══════ */

/* Build 4.5 — true view switch inside the Library content area */
.homeView{
  flex: 1;
  min-height: 0;
  display:flex;
  flex-direction:column;
  gap: var(--lib-gap);
  overflow:auto;
}

/* Build 9: library scrollbar styling */
body:not(.inPlayer) #libraryView .libSidebar,
body:not(.inPlayer) #libraryView .homeView,
body:not(.inPlayer) #libraryView .continueYacRow,
body:not(.inPlayer) #libraryView .searchResults,
body:not(.inPlayer) #libraryView .volTableBody,
body:not(.inPlayer) #videoLibraryView .libSidebar,
body:not(.inPlayer) #videoLibraryView .homeView,
body:not(.inPlayer) #videoLibraryView .videoContinueRow,
body:not(.inPlayer) #booksLibraryView .libSidebar,
body:not(.inPlayer) #booksLibraryView .booksList,
body:not(.inPlayer) #booksLibraryView .booksContinueRow,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid,
body:not(.inPlayer) #webLibraryView .libSidebar,
body:not(.inPlayer) #webLibraryView .homeView{
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,.30) transparent;
}

body:not(.inPlayer) #libraryView .libSidebar::-webkit-scrollbar,
body:not(.inPlayer) #libraryView .homeView::-webkit-scrollbar,
body:not(.inPlayer) #libraryView .continueYacRow::-webkit-scrollbar,
body:not(.inPlayer) #libraryView .searchResults::-webkit-scrollbar,
body:not(.inPlayer) #libraryView .volTableBody::-webkit-scrollbar,
body:not(.inPlayer) #videoLibraryView .libSidebar::-webkit-scrollbar,
body:not(.inPlayer) #videoLibraryView .homeView::-webkit-scrollbar,
body:not(.inPlayer) #videoLibraryView .videoContinueRow::-webkit-scrollbar,
body:not(.inPlayer) #booksLibraryView .libSidebar::-webkit-scrollbar,
body:not(.inPlayer) #booksLibraryView .booksList::-webkit-scrollbar,
body:not(.inPlayer) #booksLibraryView .booksContinueRow::-webkit-scrollbar,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel::-webkit-scrollbar,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid::-webkit-scrollbar,
body:not(.inPlayer) #webLibraryView .libSidebar::-webkit-scrollbar,
body:not(.inPlayer) #webLibraryView .homeView::-webkit-scrollbar{
  width: 8px;
  height: 8px;
}

body:not(.inPlayer) #libraryView .libSidebar::-webkit-scrollbar-track,
body:not(.inPlayer) #libraryView .homeView::-webkit-scrollbar-track,
body:not(.inPlayer) #libraryView .continueYacRow::-webkit-scrollbar-track,
body:not(.inPlayer) #libraryView .searchResults::-webkit-scrollbar-track,
body:not(.inPlayer) #libraryView .volTableBody::-webkit-scrollbar-track,
body:not(.inPlayer) #videoLibraryView .libSidebar::-webkit-scrollbar-track,
body:not(.inPlayer) #videoLibraryView .homeView::-webkit-scrollbar-track,
body:not(.inPlayer) #videoLibraryView .videoContinueRow::-webkit-scrollbar-track,
body:not(.inPlayer) #booksLibraryView .libSidebar::-webkit-scrollbar-track,
body:not(.inPlayer) #booksLibraryView .booksList::-webkit-scrollbar-track,
body:not(.inPlayer) #booksLibraryView .booksContinueRow::-webkit-scrollbar-track,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel::-webkit-scrollbar-track,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid::-webkit-scrollbar-track,
body:not(.inPlayer) #webLibraryView .libSidebar::-webkit-scrollbar-track,
body:not(.inPlayer) #webLibraryView .homeView::-webkit-scrollbar-track{
  background: transparent;
}

body:not(.inPlayer) #libraryView .libSidebar::-webkit-scrollbar-thumb,
body:not(.inPlayer) #libraryView .homeView::-webkit-scrollbar-thumb,
body:not(.inPlayer) #libraryView .continueYacRow::-webkit-scrollbar-thumb,
body:not(.inPlayer) #libraryView .searchResults::-webkit-scrollbar-thumb,
body:not(.inPlayer) #libraryView .volTableBody::-webkit-scrollbar-thumb,
body:not(.inPlayer) #videoLibraryView .libSidebar::-webkit-scrollbar-thumb,
body:not(.inPlayer) #videoLibraryView .homeView::-webkit-scrollbar-thumb,
body:not(.inPlayer) #videoLibraryView .videoContinueRow::-webkit-scrollbar-thumb,
body:not(.inPlayer) #booksLibraryView .libSidebar::-webkit-scrollbar-thumb,
body:not(.inPlayer) #booksLibraryView .booksList::-webkit-scrollbar-thumb,
body:not(.inPlayer) #booksLibraryView .booksContinueRow::-webkit-scrollbar-thumb,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel::-webkit-scrollbar-thumb,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid::-webkit-scrollbar-thumb,
body:not(.inPlayer) #webLibraryView .libSidebar::-webkit-scrollbar-thumb,
body:not(.inPlayer) #webLibraryView .homeView::-webkit-scrollbar-thumb{
  background-color: rgba(255,255,255,.18);
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: content-box;
}

body:not(.inPlayer) #libraryView .libSidebar::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #libraryView .homeView::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #libraryView .continueYacRow::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #libraryView .searchResults::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #libraryView .volTableBody::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #videoLibraryView .libSidebar::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #videoLibraryView .homeView::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #videoLibraryView .videoContinueRow::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #booksLibraryView .libSidebar::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #booksLibraryView .booksList::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #booksLibraryView .booksContinueRow::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #webLibraryView .libSidebar::-webkit-scrollbar-thumb:hover,
body:not(.inPlayer) #webLibraryView .homeView::-webkit-scrollbar-thumb:hover{
  background-color: rgba(255,255,255,.32);
}

body:not(.inPlayer) #libraryView .libSidebar::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #libraryView .homeView::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #libraryView .continueYacRow::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #libraryView .searchResults::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #libraryView .volTableBody::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #videoLibraryView .libSidebar::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #videoLibraryView .homeView::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #videoLibraryView .videoContinueRow::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #booksLibraryView .libSidebar::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #booksLibraryView .booksList::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #booksLibraryView .booksContinueRow::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #webLibraryView .libSidebar::-webkit-scrollbar-thumb:active,
body:not(.inPlayer) #webLibraryView .homeView::-webkit-scrollbar-thumb:active{
  background-color: rgba(255,255,255,.44);
}

body:not(.inPlayer) #libraryView .libSidebar::-webkit-scrollbar-corner,
body:not(.inPlayer) #libraryView .homeView::-webkit-scrollbar-corner,
body:not(.inPlayer) #libraryView .continueYacRow::-webkit-scrollbar-corner,
body:not(.inPlayer) #libraryView .searchResults::-webkit-scrollbar-corner,
body:not(.inPlayer) #libraryView .volTableBody::-webkit-scrollbar-corner,
body:not(.inPlayer) #videoLibraryView .libSidebar::-webkit-scrollbar-corner,
body:not(.inPlayer) #videoLibraryView .homeView::-webkit-scrollbar-corner,
body:not(.inPlayer) #videoLibraryView .videoContinueRow::-webkit-scrollbar-corner,
body:not(.inPlayer) #booksLibraryView .libSidebar::-webkit-scrollbar-corner,
body:not(.inPlayer) #booksLibraryView .booksList::-webkit-scrollbar-corner,
body:not(.inPlayer) #booksLibraryView .booksContinueRow::-webkit-scrollbar-corner,
body:not(.inPlayer) #booksLibraryView #booksContinuePanel::-webkit-scrollbar-corner,
body:not(.inPlayer) #booksLibraryView #booksEpisodesGrid::-webkit-scrollbar-corner,
body:not(.inPlayer) #webLibraryView .libSidebar::-webkit-scrollbar-corner,
body:not(.inPlayer) #webLibraryView .homeView::-webkit-scrollbar-corner{
  background: transparent;
}

.seriesView{
  flex: 1;
  min-height: 0;
  display:flex;
  flex-direction:column;
}

.seriesDetailPanel{
  flex: 1;
  min-height: 0;
  display:flex;
  flex-direction:column;
}

.topbar{
  display:grid;
  grid-template-columns: auto 1fr auto;
  align-items:center;
  gap: 10px;
  height: var(--lib-topbar-h);
  padding: 4px 8px;

  /* BUILD19F_TOPBAR_SURFACE (Build 19F)
     INTENT: Topbar reads as a distinct control strip above the dark library canvas.
     Divider + a soft shadow makes the boundary obvious without changing layout. */
  background: var(--topbar-bg);
  border-bottom: 1px solid var(--topbar-border2);
  box-shadow: 0 1px 0 rgba(255,255,255,.55) inset, 0 10px 22px -18px var(--topbar-shadow);
  color: var(--topbar-text);

  position:fixed;
  top:0; left:0; right:0;
  z-index: 20;

  /* Stable, “finished app” text rendering on the control strip */
  -webkit-font-smoothing: antialiased;
  text-rendering: geometricPrecision;
}
.tbLeft,.tbRight{ display:flex; align-items:center; gap:6px; position:relative; z-index:1; }
.tbLeft{ grid-column:1; }
.tbRight{ grid-column:3; }
.tbCenter{ position:absolute; left:0; right:0; top:0; bottom:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
.tbTitle{
  /* BUILD19F_TOPBAR_TYPE_TITLE (Build 19F)
     INTENT: The title should read like a proper header on a control strip, not a tiny label. */
  font-weight: 900;
  letter-spacing: .10px;
  font-size: 14px;      /* bigger, but still safe within the fixed 38px bar */
  line-height: 1;       /* keeps height stable to avoid layout drift */
  color: var(--topbar-text);
}

.iconBtn{
  appearance:none;
  width: 28px;
  height: 28px;
  border:1px solid var(--lib-border);
  background: rgba(var(--surface-rgb),.45);
  color: rgba(229,231,235,.92);
  border-radius: var(--lib-radius-sm);
  cursor:pointer;
  display:grid;
  place-items:center;
  padding:0;
  font-weight:900;
  line-height:1;
}
.iconBtn:hover{ background: rgba(var(--surface-rgb),.62); }
.iconBtn:active{ transform: translateY(1px); }
.iconBtn:disabled{ opacity:.45; cursor:default; }

/* BUILD19F_TOPBAR_CONTROLS (Build 19F)
   INTENT: Topbar controls must look intentionally designed for a light grey surface.
   Scope: ONLY inside .topbar so the rest of the Library stays dark-themed. */
.topbar .iconBtn{
  border-color: var(--topbar-border2);
  background: rgba(255,255,255,.65);
  color: var(--topbar-text);
}
.topbar .iconBtn:hover{
  background: rgba(255,255,255,.82);
  border-color: rgba(0,0,0,.18);
}
.topbar .iconBtn:disabled{
  opacity: .50; /* still readable on grey */
}

/* Button label typography on the control strip: larger, balanced, stable */
.topbar .btn{
  color: var(--topbar-text);
  border-color: var(--topbar-border2);

  /* Keep existing sizing/padding rules; just make text feel “desktop-app finished”. */
  font-size: 12px;
  font-weight: 800;
  line-height: 1;
}
.topbar .btn-ghost{
  background: rgba(255,255,255,.45);
}
.topbar .btn-ghost:hover{
  background: rgba(255,255,255,.70);
  border-color: rgba(0,0,0,.18);
}


.viewToggles{ display:flex; align-items:center; gap:4px; }

/* Compact defaults for library controls only */
body:not(.inPlayer) .btn{
  padding:6px 8px;
  border-radius: var(--lib-radius-sm);
  font-size: 11px;
}
body:not(.inPlayer) .btn-sm{ padding:4px 6px; border-radius: var(--lib-radius-sm); font-size: 11px; }
body:not(.inPlayer) .select,
body:not(.inPlayer) .search{
  padding:6px 8px;
  border-radius: var(--lib-radius-sm);
  font-size: 11px;
  min-width: 180px;
}

.navBtn{
  appearance:none;
  border:1px solid var(--lib-border);
  background: rgba(var(--surface-rgb),.35);
  color: rgba(229,231,235,.92);
  border-radius: var(--lib-radius-sm);
  padding: 6px 8px;
  cursor:pointer;
  text-align:left;
  font-weight:800;
}
.navBtn:hover{ background: rgba(var(--surface-rgb),.55); }
.navBtn:active{ transform: translateY(1px); }

/* ══════ SECTION: Sidebar & Folder Tree ══════ */

/* Build 12: library sidebar folders tree */
.folderTree{ display:flex; flex-direction:column; gap:4px; margin-top:6px; }
.folderTreeEmpty{ color: var(--muted); font-size: 11px; padding: 4px 2px; }

.folderItem{
  appearance:none;
  border:1px solid transparent;
  background: transparent;
  color: rgba(229,231,235,.90);
  border-radius: var(--lib-radius-sm);
  padding: 4px 6px;
  cursor:pointer;
  text-align:left;
  display:flex;
  align-items:center;
  gap:6px;
  min-width:0;
}
.folderItem:hover{ background: rgba(var(--surface-rgb),.35); }
.folderItem:active{ transform: translateY(1px); }
.folderItem.active{ background: rgba(var(--accent-rgb),.12); border-color: rgba(var(--accent-rgb),.25); }

.folderIcon{ width: 16px; text-align:center; opacity:.90; flex: 0 0 auto; }
.folderFavicon{ width:16px; height:16px; object-fit:contain; display:block; }
.folderLabel{ min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex: 1 1 auto; }
.folderCount{ color: var(--muted); font-variant-numeric: tabular-nums; flex: 0 0 auto; }
.folderChild{ margin-left: 14px; }

/* Sidebar downloads (compact) */
.sidebarDlList{ display:flex; flex-direction:column; gap:4px; margin-top:6px; }
.sidebarDlItem{
  display:flex; flex-direction:column; gap:2px;
  padding:6px 8px;
  border-radius:8px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  cursor:pointer;
  transition:background .12s;
}
.sidebarDlItem:hover{ background:rgba(255,255,255,.08); }
.sidebarDlItem:active{ transform:translateY(1px); }
.sidebarDlItem--active{ border-color:rgba(255,255,255,.12); }
.sidebarDlItem--bad .sidebarDlSub{ color:var(--danger, #f87171); }
.sidebarDlName{
  font-size:11px; line-height:1.3;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.sidebarDlSub{
  font-size:10px; opacity:.7;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.sidebarDlBar{
  height:3px; margin-top:2px;
  background:rgba(255,255,255,.10);
  border-radius:999px; overflow:hidden;
}
.sidebarDlFill{
  height:100%; width:0%;
  background:rgba(255,255,255,.55);
  transition:width .15s;
}

/* ══════ SECTION: Global Search ══════ */

/* Global search */
.globalSearchWrap{
  position:relative;
  flex: 1;
  max-width: 460px;
}
.globalSearchWrap.compact{ max-width: 360px; }
.globalSearch{
  width: 100%;
  min-width: 200px;
}
.searchResults{
  position:absolute;
  left:0; right:0;
  top: calc(100% + 6px);
  background: rgba(var(--surface-rgb),.98);
  border:1px solid var(--lib-border);
  border-radius: var(--lib-radius);
  overflow:hidden;
  box-shadow: 0 16px 40px rgba(0,0,0,.45);
  max-height: min(60vh, 560px);
  overflow-y:auto;
  z-index: 40;

  /* BUILD19F_SEARCH_DROPDOWN_TEXT (Build 19F)
     INTENT: .searchResults lives inside .topbar in the DOM.
     Once topbar text turns dark, we MUST force dropdown text back to light for legibility. */
  color: var(--text);
}
.resGroup{ padding: 8px 8px 4px; }
.resHead{ font-weight:850; font-size:11px; color: var(--muted); letter-spacing:.2px; text-transform:uppercase; }
.resItem{
  display:flex;
  gap:10px;
  padding: 6px 8px;
  border-radius: var(--lib-radius-sm);
  cursor:pointer;
}
.resItem:hover{ background: rgba(var(--accent-rgb),.10); }
.resItem.active{ background: rgba(var(--accent-rgb),.16); border:1px solid rgba(var(--accent-rgb),.35); }
.resType{
  width: 18px; height: 18px;
  display:grid; place-items:center;
  border-radius: 6px;
  border:1px solid rgba(255,255,255,.22);
  background: rgba(var(--surface-rgb),.40);
  flex: 0 0 auto;
  font-size: 11px;
}
.resMain{ font-weight:900; line-height:1.1; }
.resSub{ color: var(--muted); font-size: 11px; margin-top: 2px; }
.resText{ min-width:0; }
.resMain, .resSub{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.resEmpty{ padding: 12px; color: var(--muted); font-size: 12px; }
.btn{
  appearance:none;
  border:1px solid rgba(var(--accent-rgb),.55);
  background: rgba(var(--accent-rgb),.16);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
  font-weight:750;
}
.btn:active{ transform: translateY(1px); }
.btn-ghost{
  border:1px solid rgba(255,255,255,.25);
  background: rgba(var(--surface-rgb),.55);
  color:var(--text);
}
.btn-sm{ padding:6px 10px; border-radius:10px; font-size:12px; }
main{ padding: 14px 16px 18px; max-width: 1200px; margin:0 auto; }
.view{ display:grid; gap:14px; }
.panel{
  background: var(--panel);
  border:1px solid var(--lib-border);
  border-radius:var(--lib-radius);
  padding: var(--lib-pad);
}
.panelTitle{ font-weight:800; margin-bottom:10px; }
.panelTitleRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
.contTools{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.toggle{ display:flex; align-items:center; gap:8px; user-select:none; }
.toggle input{ width:16px; height:16px; }
.crumb{ display:flex; align-items:center; gap:10px; }
.muted{ color:var(--muted); }
.tiny{ font-size:12px; }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

.hidden{ display:none !important; }

/* ══════ SECTION: Continue Reading Shelf ══════ */

/* Continue Reading (Build 2) */
.continuePanel{
  height: 430px;
  margin-top: 0;
  padding: 0;
  display:flex;
  flex-direction:column;
}
.continueHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-left: 25px;
  margin-top: 15px;
  margin-right: 20px;
}
.continueTitle{
  font-size: 18px;
  font-weight: 600; /* DemiBold */
  letter-spacing: .1px;
}

.continueYacRow{
  flex:1;
  min-height:0;
  display:flex;
  gap: 20px;
  overflow-x:auto;
  overflow-y:hidden;
  padding: 20px 0;
  margin: 15px 20px 20px 25px;
}
.continueEmpty{ margin: 0 20px 0 25px; padding-bottom: 10px; }

.contTile{
  width: var(--cont-cover-w, 160px);
  height: var(--cont-cover-h, 240px);
  flex: 0 0 auto;
  border: 1px solid rgba(255,255,255,.125); /* #20FFFFFF */
  border-radius: var(--lib-radius-sm);
  background: transparent;
  cursor:pointer;
  position:relative;
  display:flex;
  flex-direction:column;
  transition: transform 90ms ease-out;
  will-change: transform;
}
.contTile:hover{ transform: scale(1.025); }

.contCover{
  border: 1px solid rgba(255,255,255,.188); /* #30FFFFFF */
  border-radius: var(--lib-radius-sm);
  overflow:hidden;
  background:#000;
  position:relative;
  flex:1;
}
.contCoverImg{ width:100%; height:100%; display:block; object-fit: cover; }

.contTitleWrap{ margin: 4px 4px 0; min-width:0; }
.contTileTitle{ font-weight: 600; color: rgba(229,231,235,.92); }

.contTile .contFinish,
.contTile .contRemove{
  position:absolute;
  top: 6px;
  width: 22px;
  height: 22px;
  padding:0;
  display:grid;
  place-items:center;
  appearance:none;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.45);
  color:rgba(229,231,235,.92);
  border-radius: 6px;
  cursor:pointer;
  font-weight:900;
  opacity: 0;
  transition: opacity 90ms ease-out;
}
.contTile .contFinish{ left: 6px; }
.contTile .contRemove{ right: 6px; }
.contTile:hover .contFinish,
.contTile:hover .contRemove{ opacity: 1; }
.contTile .contFinish:active,
.contTile .contRemove:active{ transform: translateY(1px); }

.contTile.finished{ opacity: .78; }

.contBadgeRow{
  position:absolute;
  left: 6px;
  bottom: 6px;
  display:flex;
  gap:6px;
}
.contBadgeRow .badge{
  padding: 2px 6px;
  font-size: 11px;
  border-radius: 999px;

  /* BUILD19F_CONT_BADGE_LEGIBILITY (Build 19F)
     INTENT: Overlay labels must remain readable across bright/high-contrast cover art.
     This is a contrast aid only (no positioning, size, or behavior change). */
  background: rgba(0,0,0,.45);
  border-color: rgba(255,255,255,.18);
  text-shadow: 0 1px 2px rgba(0,0,0,.80);
  backdrop-filter: blur(4px);
}

/* BUILD17_CONTINUE_PERCENT_BADGE (Build 17) */
.contPctBadge{
  position:absolute;
  right: 6px;
  bottom: 6px;
  display:flex;
}
.contPctBadge .badge{
  padding: 2px 6px;
  font-size: 11px;
  border-radius: 999px;

  /* BUILD19F_CONT_PCT_LEGIBILITY (Build 19F)
     INTENT: Same overlay readability guarantee for the percent badge. */
  background: rgba(0,0,0,.45);
  border-color: rgba(255,255,255,.18);
  text-shadow: 0 1px 2px rgba(0,0,0,.80);
  backdrop-filter: blur(4px);
}
.badge-finished{
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.35);
  color: rgba(229,231,235,.86);
}

/* ══════ SECTION: Series Grid & Tiles ══════ */

/* Series */
.seriesPanel{ padding: 6px; }
.seriesPanel .panelTitleRow{ margin-bottom: 6px; }

.seriesGrid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(132px, 1fr));
  gap: 8px;
  padding: 2px;
}
.seriesCard{
  border: 1px solid rgba(255,255,255,.125); /* #20FFFFFF */
  background: transparent;
  border-radius: var(--lib-radius-sm);
  padding: 6px;
  cursor:pointer;
  position:relative;
  transition: transform 90ms ease-out, background 90ms ease-out, border-color 90ms ease-out;
}
.seriesCard:hover{
  background: var(--lib-hover);
  transform: scale(1.01);
  border-color: rgba(255,255,255,.16);
}

/* Cover-first tile */
.seriesCard .seriesCoverWrap{
  position:relative;
}

/* Optional stacked plates (restrained) */
.seriesCard .seriesCoverWrap::before,
.seriesCard .seriesCoverWrap::after{
  content:"";
  position:absolute;
  inset: 2px;
  border-radius: 10px;
  background: rgba(0,0,0,.22);
  pointer-events:none;
}
.seriesCard .seriesCoverWrap::before{ transform: rotate(-4deg) translate(-2px, 2px); opacity: .55; }
.seriesCard .seriesCoverWrap::after{ transform: rotate(3deg) translate(2px, -2px); opacity: .38; }

.seriesCard .seriesCoverWrap .thumbWrap{
  position:relative;
  z-index: 1;
  width: 100%;
  height: auto;
  aspect-ratio: 65 / 100;
  border: 1px solid rgba(255,255,255,.188); /* #30FFFFFF */
  border-radius: 10px;
  overflow:hidden;
  background: rgba(0,0,0,.35);
}

.seriesCard .seriesCoverWrap .thumb{
  width: 100%;
  height: 100%;
  object-fit: cover;
  image-rendering: auto;
}

.seriesName{
  margin-top: 6px;
  font-size: 12px;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: none;
}

/* INTENT: series tiles should stay cover-first tiles; this prevents the generic card flex rule from collapsing titles. */
.seriesGrid .seriesCard{ display:block; }


.seriesInfo{ margin-top: 6px; min-width:0; }
.seriesTitle{
  font-weight: 650;
  font-size: 11px;
}
.seriesMeta{
  margin-top: 4px;
  font-size: 11px;
  color: var(--muted);
  display:flex;
  justify-content:space-between;
  gap: 6px;
  min-width:0;
}
.seriesMeta span.mono{ flex:1; min-width:0; text-align:right; display:none; }

/* Build 10: series card containment */
/* Ensure the "X volumes" label can shrink/truncate and never bleed into neighboring tiles. */
.seriesCard{ overflow:hidden; min-width:0; }
.seriesMeta{ overflow:hidden; }
.seriesMeta > span{ min-width:0; }
.seriesMeta > span:first-child{
  max-width:100%;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  display:block;
}

.seriesRemove{
  position:absolute;
  top: 6px;
  right: 6px;
  width: 18px;
  height: 18px;
  padding: 0;
  display:grid;
  place-items:center;
  appearance:none;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.35);
  color:rgba(229,231,235,.9);
  border-radius: 6px;
  cursor:pointer;
  font-weight:900;
  opacity: 0;
  transition: opacity 90ms ease-out;
}
.seriesCard:hover .seriesRemove{ opacity: 1; }
.seriesRemove:active{ transform: translateY(1px); }

/* ══════ SECTION: Volumes & Episode Table ══════ */

/* Volumes */
.volBar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-top: 10px;
}
.volControls{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.select{
  appearance:none;
  border:1px solid rgba(255,255,255,.25);
  background: rgba(var(--surface-rgb),.55);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
}
/* FIX-R03: dark option background for all selects */
.select option { background: #1a1c22; color: #e6e6e6; }
.search{
  border:1px solid rgba(255,255,255,.25);
  background: rgba(var(--surface-rgb),.55);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  min-width: 260px;
}

/* BUILD19F_TOPBAR_SEARCH (Build 19F)
   INTENT: The topbar search should look like a real input on grey (clear edge, readable placeholder).
   We do not touch sizing, padding, radius, or min-width to avoid layout change. */
.topbar .search{
  background: var(--topbar-bg2);
  border-color: var(--topbar-border2);
  color: var(--topbar-text);
  box-shadow: 0 1px 0 rgba(255,255,255,.75) inset;
}

.topbar .search::placeholder{
  color: var(--topbar-muted);
  opacity: 1;
}

.topbar .search:focus{
  outline: none;

  /* Keep existing accent language but tuned for grey; no size/layout impact */
  border-color: rgba(var(--accent-rgb),.55);
  box-shadow: 0 0 0 3px rgba(var(--accent-rgb),.14);
}


.volumesList{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top: 8px;
}
.volRow{
  display:flex;
  align-items:center;
  gap:10px;
  border:1px solid rgba(255,255,255,.22);
  background: rgba(var(--surface-rgb),.40);
  border-radius:var(--lib-radius);
  padding:6px 8px;
  cursor:pointer;
}
.volRow:hover{ border-color: rgba(var(--accent-rgb),.55); }
.volInfo{ flex:1; min-width:0; }
.volTitle{ font-weight:900; line-height:1.15; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.volRight{ display:flex; align-items:center; gap:8px; }
.thumbWrap.small{ width:64px; height:92px; }
.thumbWrap.small .thumb{ width:64px; height:92px; }
.badge{
  display:inline-flex; align-items:center; gap:6px;
  border:1px solid rgba(var(--accent-rgb),.45);
  background: rgba(var(--accent-rgb),.12);
  padding:4px 8px;
  border-radius:999px;
  font-size:12px;
  color:rgba(229,231,235,.92);
}



/* ══════ SECTION: Inside-Series View ══════ */

/* Build 4 — Inside folder/series view: split preview + dense table */
/* Build 4.5 — the inside-series panel is a dedicated view (not stacked under HomeView). */
#seriesDetailPanel{ flex:1; min-height:0; display:flex; flex-direction:column; }
#seriesDetailPanel .panelTitleRow{ flex:0 0 auto; }

.volSplit{ display:flex; flex-direction:column; flex:1; min-height:0; gap:6px; }

.volPreviewPane{
  flex: 2 1 0;
  min-height: 0;
  position:relative;
  border: 1px solid var(--lib-border);
  border-radius: var(--lib-radius-sm);
  background: rgba(0,0,0,.72);
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.volPreviewInfo{ position:absolute; top:8px; left:10px; color: rgba(229,231,235,.74); }
.volPreviewCenter{ width:100%; height:100%; display:flex; align-items:center; justify-content:center; padding: 10px; }
.volPreviewImg{
  max-width: min(540px, 72%);
  max-height: 100%;
  object-fit: contain;
  image-rendering: auto;
  border-radius: 10px;
  border:1px solid rgba(255,255,255,.18);
  background:#000;
  box-shadow: 0 14px 34px rgba(0,0,0,.55);
}
/* Comics folder preview: use height-led sizing so covers visibly appear larger. */
#volPreviewPane .volPreviewCenter{
  padding: 4px !important;
}
#volPreviewImg{
  width: auto;
  height: min(92%, 560px);
  max-width: min(640px, 84%);
  max-height: none;
}

/* Extracted to video-player.css */


.volTableWrap{
  flex: 1 1 0;
  min-height: 0;
  border: 1px solid var(--lib-border);
  border-radius: var(--lib-radius-sm);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  background: rgba(var(--surface-rgb),.18);
}
.volTableHead{
  flex:0 0 auto;
  display:grid;
  grid-template-columns: 42px minmax(160px, 2.1fr) minmax(180px, 2.4fr) 70px 84px 60px 92px 132px;
  gap:10px;
  padding: 6px 10px;
  background: rgba(229,231,235,.08);
  color: rgba(229,231,235,.84);
  border-bottom:1px solid rgba(255,255,255,.20);
  font-weight:800;
  user-select:none;
}
.volTableHead .cell{ min-width:0; }
.volTableBody{
  flex:1;
  min-height:0;
  overflow:auto;
}

.volTrow{
  display:grid;
  grid-template-columns: 42px minmax(160px, 2.1fr) minmax(180px, 2.4fr) 70px 84px 60px 92px 132px;
  gap:10px;
  padding: 4px 10px;
  align-items:center;
  cursor:default;
  border-bottom:1px solid rgba(255,255,255,.12);
}
.volTrow:last-child{ border-bottom:0; }
.volTrow.alt{ background: rgba(255,255,255,.03); }
.volTrow:hover{ background: rgba(255,255,255,.06); }
.volTrow.sel{ background: var(--lib-select); }
.volTrow .cell{ min-width:0; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
/* Build 85: Always show the full filename in episode list (no ellipsis). */
.volTrow .cell.file{ white-space:normal; overflow:visible; text-overflow:clip; word-break:break-all; }

.volTrow .cell.num{ color: rgba(229,231,235,.70); text-align:right; padding-right: 4px; }
.volTrow .cell.read{ text-align:center; }

#volumesWrap.previewHidden .volPreviewPane{ display:none; height:0; }
#volumesWrap.previewHidden .volTableWrap{ flex: 1 1 auto; }

/* Build 3.4: video episodes view uses the same split layout; mirror the hide-preview behavior */
#videoEpisodesWrap.previewHidden .volPreviewPane{ display:none; height:0; }
#videoEpisodesWrap.previewHidden .volTableWrap{ flex: 1 1 auto; }
#booksEpisodesWrap.previewHidden .volPreviewPane{ display:none; height:0; }
#booksEpisodesWrap.previewHidden .volTableWrap{ flex: 1 1 auto; }

/* Video-scoped episode table rules extracted to video-player.css */
#booksEpTableHead{ grid-template-columns: 42px minmax(320px, 5fr) 92px 92px 120px 132px; }
#booksEpisodesGrid .volTrow{ grid-template-columns: 42px minmax(320px, 5fr) 92px 92px 120px 132px; }

/* Books episode table readability (video equivalents in video-player.css) */
#booksEpisodesWrap .cell.size,
#booksEpisodesWrap .cell.duration,
#booksEpisodesWrap .cell.date{
  text-align: right;
}
#booksEpisodesWrap .cell.resolution{
  text-align: center;
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum" 1;
}
#booksEpisodesWrap .cell.progress{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
#booksEpisodesWrap .videoEpProgressTrack{
  flex: 1 1 auto;
  min-width: 0;
  height: 6px;
  border-radius: 999px;
  background: rgba(255,255,255,.12);
  overflow: hidden;
}
#booksEpisodesWrap .videoEpProgressFill{
  height: 100%;
  width: 0%;
  background: rgba(255,255,255,.65);
}
#booksEpisodesWrap .videoEpProgressLabel{
  flex: 0 0 auto;
  min-width: 40px;
  text-align: right;
  font-size: 11px;
  color: rgba(229,231,235,.74);
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum" 1;
}
#booksEpisodesWrap .videoEpTitleMain{
  font-weight: 650;
  color: rgba(229,231,235,.90);
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
#booksEpisodesWrap .videoEpTitleSub{
  margin-top: 2px;
  font-size: 11px;
  color: rgba(229,231,235,.58);
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
#booksEpisodesWrap .volTrow .cell.title{
  display:flex;
  flex-direction:column;
  min-width:0;
}

/* Video subfolder sections extracted to video-player.css */

/* Build 22: inside-show explorer folder rows */
.volTrow.folderRow{ cursor: pointer; }
.volTrow.folderRow:hover{ background: rgba(255,255,255,.08); }
.volTrow.folderRow .cell.title{ font-weight: 800; }


/* ══════ SECTION: Volume Navigator & Overlays ══════ */

/* Volume navigator overlay */
.volNavOverlay{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:55;
}
.volNavCard{
  width:min(860px, 100%);
  max-height: min(82vh, 760px);
  overflow:hidden;
  background: var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.volNavTop{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.volNavTitle{ font-weight:900; font-size:18px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.volNavSearch{ width:100%; min-width:0; }
.volNavList{ flex:1; overflow:auto; display:flex; flex-direction:column; gap:10px; padding-right:6px; }
.volNavItem{
  display:flex;
  align-items:center;
  gap:12px;
  border:1px solid rgba(255,255,255,.22);
  background: rgba(var(--surface-rgb),.40);
  border-radius:16px;
  padding:10px 12px;
  cursor:pointer;
}
.volNavItem:hover{ border-color: rgba(var(--accent-rgb),.55); }
.volNavItem.active{ border-color: rgba(var(--accent-rgb),.85); box-shadow: 0 0 0 2px rgba(var(--accent-rgb),.18) inset; }
.volNavInfo{ flex:1; min-width:0; }
.volNavMain{ font-weight:900; line-height:1.15; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.volNavMeta{ color:var(--muted); font-size:12px; margin-top:2px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.volNavRight{ display:flex; align-items:center; gap:8px; }
.volNavPill{
  display:inline-flex; align-items:center;
  border:1px solid rgba(var(--accent-rgb),.45);
  background: rgba(var(--accent-rgb),.12);
  padding:4px 8px;
  border-radius:999px;
  font-size:12px;
  color:rgba(229,231,235,.92);
  white-space:nowrap;
}

/* Keys overlay */
.keysOverlay{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:50;
}
.keysCard{
  width:min(980px, 100%);
  max-height: min(80vh, 720px);
  overflow:auto;
  background: var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
}
.keysTop{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.keysTitle{ font-weight:900; font-size:18px; }
.keysCols{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-top:12px; }
.keysHead{ font-weight:800; margin-bottom:8px; }
.keysLine{ display:flex; justify-content:space-between; gap:14px; padding:6px 0; border-bottom:1px solid rgba(255,255,255,.14); }
.keysLine:last-child{ border-bottom:0; }
.key{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-weight:800;
  border:1px solid rgba(255,255,255,.22);
  background: rgba(var(--surface-rgb),.35);
  padding:3px 8px;
  border-radius:10px;
  white-space:nowrap;
}
.desc{ color:var(--muted); font-size:13px; text-align:right; }
.keysHint{ margin-top:12px; }

/* Library settings overlay (Build 42A) */
.settingsOverlay{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:52;
}
.settingsCard{
  width:min(720px, 100%);
  max-height: min(82vh, 760px);
  overflow:auto;
  background: var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
/* INTENT: Use an explicit system font stack here so the header stays consistent without bundled font assets. */
.settingsTop{
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
 display:flex; align-items:center; justify-content:space-between; gap:12px; }
.settingsTop *{
  font-family: inherit;
}

.settingsTitle{ font-weight:900; font-size:18px; }
.settingsGroup{ display:flex; flex-direction:column; gap:6px; }
.settingsLabel{ font-weight:800; }
.settingsNum{ width: 260px; max-width: 100%; }
.settingsActions{ display:flex; align-items:center; justify-content:flex-end; gap:10px; margin-top: 6px; }

/* Build 45D: Hidden series list (library overlay) */
.hiddenSeriesList{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top: 6px;
}

.hiddenSeriesRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 8px 10px;
  border:1px solid var(--lib-border);
  border-radius: var(--lib-radius-sm);
  background: rgba(var(--surface-rgb),.35);
}

.hiddenSeriesText{
  min-width:0;
  flex: 1 1 auto;
}

.hiddenSeriesName{
  font-weight: 850;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.hiddenSeriesPath{
  margin-top: 2px;
  color: var(--muted);
  font-size: 11px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

@media (max-width: 760px){
  .keysCols{ grid-template-columns: 1fr; }
  .search{ min-width: 180px; }
}

/* ══════ SECTION: Comic Reader / Player ══════ */

/* Player bar, stage, click zones, scrub, footer extracted to comic-reader.css */
/* ══════ SECTION: Toast & Hint ══════ */

.hint{ margin-left:auto; }

.toast{
  position: fixed;
  left: 50%;
  bottom: var(--toastBottom, 18px);
  transition: bottom 140ms ease-out;
  transform: translateX(-50%);
  background: rgba(var(--surface-rgb),.85);
  border:1px solid rgba(255,255,255,.28);
  color: var(--text);
  padding: 10px 12px;
  border-radius: 999px;
  font-size: 13px;
  backdrop-filter: blur(8px);
  z-index: 99;
}

/* ══════ SECTION: Context Menu ══════ */

/* FIND_THIS:CONTEXT_MENU_STYLES */
.contextMenu{
  position: fixed;
  min-width: 190px;
  max-width: 280px;
  padding: 6px;
  background: rgba(var(--surface-rgb), .94);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 12px;
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  z-index: 120;
}
.contextMenu.hidden{ display:none !important; }

.contextMenuItem{
  width: 100%;
  display: block;
  padding: 8px 10px;
  border: 0;
  border-radius: 10px;
  background: transparent;
  color: var(--text);
  font-size: 13px;
  text-align: left;
  cursor: pointer;
}
.contextMenuItem:hover{ background: rgba(255,255,255,.08); }

.contextMenuItem.disabled{
  opacity: .45;
  cursor: default;
}
.contextMenuItem.disabled:hover{ background: transparent; }

.contextMenuItem.danger{
  color: rgb(248,113,113);
}

.contextMenuSep{
  height: 1px;
  margin: 6px 6px;
  background: rgba(255,255,255,.14);
}

/* End overlay, mega settings extracted to comic-reader.css */

/* HUD hide and player body rules extracted to comic-reader.css */


/* Thumbnails */
.thumbWrap{
  width: 60px;
  height: 84px;
  border-radius: 12px;
  background: rgba(0,0,0,.6);
  border: 1px solid rgba(255,255,255,.22);
  overflow: hidden;
  flex: 0 0 auto;
}
.thumb{
  width:100%;
  height:100%;
  display:block;
  object-fit: cover;
  background:#000;
}
.contCard{ display:flex; gap:10px; align-items:center; }
.contCard .contInfo{ min-width:0; flex:1; }
.seriesCard{ display:flex; gap:12px; align-items:center; }
.seriesCard .seriesInfo{ min-width:0; flex:1; }
.bookCard{ display:flex; gap:12px; align-items:center; }
.bookCard .bookInfo{ min-width:0; flex:1; }
.speedBtns{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap: wrap;
}
.chip.speed{
  padding:6px 12px;
}
/* Edge-to-edge player layout and icon overrides extracted to comic-reader.css */

/* ══════ SECTION: Loading Overlay & Spinner ══════ */

/* Loading overlay (spinner + optional progress bar) */
.loadingOverlay{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.45);
  z-index: 200;
}
.loadingOverlay.hidden{ display:none; }
.loadingCard{
  display:flex;
  align-items:center;
  gap: 12px;
  width: min(560px, calc(100vw - 32px));
  background: rgba(var(--surface-rgb),.92);
  border:1px solid rgba(255,255,255,.28);
  border-radius: 18px;
  padding: 14px 16px;
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
}
.spinner{
  width: 22px;
  height: 22px;
  border-radius: 999px;
  border: 3px solid rgba(229,231,235,.28);
  border-top-color: rgba(229,231,235,.95);
  animation: spin .9s linear infinite;
  flex: 0 0 auto;
}
@keyframes spin{ to{ transform: rotate(360deg); } }
.loadingTitle{ font-weight: 900; }
.loadingSub{ max-width: 56vw; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.loadingBarWrap{
  margin-top: 7px;
  height: 6px;
  border-radius: 999px;
  background: rgba(255,255,255,.18);
  border:1px solid rgba(255,255,255,.20);
  overflow:hidden;
}
.loadingBar{
  height: 100%;
  width: 0%;
  background: rgba(var(--accent-rgb),.55);
}

/* Warmup bar and debug overlay extracted to comic-reader.css */

/* Mode menu, auto-flip countdown extracted to comic-reader.css */


  /* BUILD16C_SCAN_PILL: subtle indicator during background worker scans */
  .scanPill{
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    color: rgba(255,255,255,.82);
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.12);
    margin-right: 10px;
    pointer-events: auto;
    gap: 8px;
  }

  .settingsTextArea{
    width: 100%;
    resize: vertical;
    min-height: 72px;
    padding: 10px 12px;
    border-radius: 10px;
  }


/* Goto card, FX card, loupe extracted to comic-reader.css */

/* ══════ SECTION: Video Mode (Library + Player) ══════ */

/* Tankoban Plus Build 1: mode switch + video views */
.modeSwitch{ display:flex; gap:6px; align-items:center; justify-content:center; margin-top:6px; }
.modeBtn{ padding:6px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.16); background:rgba(255,255,255,0.06); color:inherit; cursor:pointer; font-size:12px; }
.modeBtn.active{ background:rgba(255,255,255,0.14); border-color:rgba(255,255,255,0.28); }

.scanPill{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.14); background:rgba(255,255,255,0.06); }
.scanCancel{ padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,0.16); background:rgba(255,255,255,0.08); color:inherit; cursor:pointer; font-size:12px; }

/* Video library rows, player shell, HUD, scrub, context menu, tracks panel,
   prompt, and continue panel extracted to video-player.css */

#booksContinuePanel{
  height: 430px;
  display:flex;
  flex-direction:row;
}

/* FIX-TILES: match Comics continue tile pattern — tile height auto, cover gets explicit size */
#booksContinuePanel.continueYacRow{
  align-items: flex-start !important;
}
#booksContinuePanel .contTile{
  width: 200px !important;
  height: auto !important;
}
#booksContinuePanel .contCover{
  height: 308px !important;
  flex: 0 0 auto !important;
}
body[data-tile-density="compact"] #booksContinuePanel .contTile{
  width: 170px !important;
}
body[data-tile-density="compact"] #booksContinuePanel .contCover{
  height: 262px !important;
}

#booksContinueList{
  display:none !important;
}

/* Toast-only scan UX in Books/Video continue panels: never show persistent refresh pills. */
#booksLibraryView #booksScanPill,
#videoLibraryView #videoScanPill{
  display: none !important;
}

/* Video continue row extracted to video-player.css */
.contTileSub{ margin-top:4px; line-height:1.2; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; opacity:0.8; }

/* TankobanPlus Build 23 — Videos: drag-and-drop image files onto show tiles to set posters. */
.seriesCard.posterDropTarget .seriesCoverWrap{ outline:2px dashed var(--accent); outline-offset:4px; }
.contTile.posterDropTarget .contCover{ outline:2px dashed var(--accent); outline-offset:4px; }

/* FIX-TILES: density-aware books grid (match comics/video) */
#booksShowsGrid.seriesGrid{
  padding: 2px;
}
body[data-tile-density="comfortable"] #booksShowsGrid.seriesGrid{
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
}
body[data-tile-density="compact"] #booksShowsGrid.seriesGrid{
  grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
  gap: 12px;
}

#booksLibraryView .videoRootRemove{
  margin-left: 6px;
  padding: 2px 8px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  color: rgba(229,231,235,.70);
  font-size: 11px;
  font-weight: 650;
  cursor: pointer;
  flex: 0 0 auto;
}

#booksLibraryView .videoRootRemove:hover{
  background: rgba(255,255,255,.07);
  border-color: rgba(255,255,255,.14);
  color: rgba(229,231,235,.86);
}


/* Video Player Shell mode extracted to video-player.css */



/* HUD panels, volume/speed, overlay fixes, OSD extracted to video-player.css */

/* ══════ SECTION: Books Mode Stubs (legacy — see books-reader.css) ══════ */
body.inBooksMode #hiddenSeriesBtn,
body.inWebMode #tileDensityBtn,
body.inWebMode #hiddenSeriesBtn {
  display: none !important;
}


/* BUILD_OVERHAUL: book reader layout now in books-reader.css */
.booksReaderHost .booksFoliateView,
.booksReaderHost foliate-view {
  display: block;
  width: 100%;
  height: 100%;
  min-height: 100%;
}

/* BUILD_OVERHAUL: click zones, HUD bars, TOC overlay removed — see books-reader.css */

/* Focus-visible outlines for book reader elements */
.booksReaderView .iconBtn:focus-visible,
.booksReaderView select:focus-visible,
.booksReaderView input:focus-visible,
.booksReaderTtsBar .iconBtn:focus-visible,
.booksReaderErrorBtn:focus-visible,
.booksReaderDictCloseBtn:focus-visible {
  outline: 2px solid rgba(100, 160, 255, 0.7);
  outline-offset: 1px;
  border-radius: 4px;
}

.booksReaderHost[data-reader-theme="light"] {
  background: #ffffff;
  color: #111111;
}

.booksReaderHost[data-reader-theme="sepia"] {
  background: #f4ecdc;
  color: #4d3d2c;
}

.booksReaderHost[data-reader-theme="dark"] {
  background: #101216;
  color: #e4e8ef;
}

/* UI-F07: status row collapses when empty, auto-fades transient messages */
.booksReaderStatus {
  padding: 0 10px;
  font-size: 11px;
  color: var(--muted);
  border-top: 1px solid var(--lib-border);
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: max-height 0.25s ease, opacity 0.25s ease, padding 0.25s ease;
}
.booksReaderStatus.visible {
  max-height: 28px;
  padding: 5px 10px;
  opacity: 1;
}

.booksReaderOpenError {
  margin: 18px;
  border: 1px solid var(--lib-border);
  border-radius: 10px;
  padding: 12px;
  background: rgba(var(--surface-rgb), 0.42);
  color: var(--text);
  font-size: 12px;
}

.booksReaderTextWrap {
  width: 100%;
  height: 100%;
  overflow: auto;
}

.booksReaderTextDoc {
  max-width: 960px;
  margin: 0 auto;
}

.booksReaderTextDoc p {
  margin: 0 0 0.9em;
}

.booksReaderEpubStage {
  width: 100%;
  height: 100%;
}

/* BUILD_OVERHAUL: mega overlay styles removed — settings now in sidebar */

.booksReaderPdfWrap {
  width: 100%;
  height: 100%;
  overflow: auto;
  display: grid;
  justify-items: center;
  align-content: start;
  gap: 10px;
  padding: 10px;
}

.booksReaderPdfStatus {
  font-size: 11px;
  color: var(--muted);
}

.booksReaderPdfCanvas {
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
  background: #ffffff;
}

/* WAVE1: search hit count label */
.booksReaderSearchCount {
  font-size: 11px;
  color: var(--muted);
  min-width: 32px;
  text-align: center;
  white-space: nowrap;
  user-select: none;
}

.booksSearchHit {
  background: #f9de64;
  color: #111;
  border-radius: 2px;
  padding: 0 1px;
}

.booksSearchHitActive {
  background: #7bc6ff;
  color: #091018;
}

/* WAVE2: hidden Aa panel stub (compatibility only) */
.booksReaderAaPanel { display: none; }

/* UI-F01: Error banner (floats inside stageWrap) */
.booksReaderErrorBanner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 14px;
  background: rgba(220, 60, 60, 0.12);
  border: 1px solid rgba(220, 60, 60, 0.3);
  border-radius: 8px;
  font-size: 12px;
  position: absolute;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: min(480px, calc(100% - 32px));
  z-index: 20;
  backdrop-filter: blur(8px);
}

.booksReaderErrorMsg {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
  flex: 1;
}

.booksReaderErrorTitle {
  font-size: 13px;
  color: var(--text, #e4e8ef);
}

.booksReaderErrorDetail {
  font-size: 11px;
  color: var(--muted, #8b8fa3);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.booksReaderErrorActions {
  display: flex;
  gap: 6px;
  flex-shrink: 0;
}

.booksReaderErrorBtn {
  font-size: 11px;
  padding: 3px 10px;
  border-radius: 4px;
  border: 1px solid var(--lib-border);
}

/* BUILD_OVERHAUL: old bookmark mega-panel styles removed — now sidebar */

/* WAVE3: Dictionary popup */
.booksReaderDictPopup {
  position: absolute;
  bottom: 80px;
  right: 12px;
  width: 320px;
  max-height: 340px;
  background: var(--surface, #1a1c22);
  border: 1px solid var(--lib-border);
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  z-index: 50;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
/* UI-F05: when JS sets data-anchored, use top/left instead of fixed bottom/right */
.booksReaderDictPopup[data-anchored="true"] {
  bottom: auto;
  right: auto;
}

.booksReaderDictHead {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 10px;
  border-bottom: 1px solid var(--lib-border);
}

.booksReaderDictWord {
  font-weight: 700;
  font-size: 14px;
}

.booksReaderDictCloseBtn {
  font-size: 12px;
}

.booksReaderDictBody {
  padding: 8px 10px;
  font-size: 12px;
  line-height: 1.5;
  overflow: auto;
  flex: 1;
  min-height: 0;
}

.booksReaderDictBody .dictDef {
  margin-bottom: 6px;
}

.booksReaderDictBody .dictPos {
  font-style: italic;
  color: var(--muted);
  margin-right: 4px;
}

.booksReaderDictBody .dictLink {
  color: rgba(100, 160, 255, 0.9);
  cursor: pointer;
  text-decoration: underline;
}

.booksReaderDictBody .dictError {
  color: var(--muted);
  font-style: italic;
}

/* WAVE4 + UI-F08: TTS bar floats over content, no layout shift */
.booksReaderTtsBar {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: rgba(var(--surface-rgb, 26, 28, 34), 0.92);
  border: 1px solid var(--lib-border);
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  font-size: 12px;
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 40;
  max-width: calc(100% - 24px);
  backdrop-filter: blur(8px);
}

.booksReaderTtsBtn {
  font-size: 13px;
  min-width: 26px;
}

.booksReaderTtsSpeed {
  font-size: 11px;
  min-width: 34px;
  text-align: center;
  color: var(--muted);
  user-select: none;
}

/* TTS-F03: voice picker select */
.booksReaderTtsVoice {
  font-size: 11px;
  max-width: 140px;
  padding: 2px 4px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 4px;
  background: rgba(30, 32, 40, 0.7);
  color: var(--muted);
  outline: none;
  cursor: pointer;
}
.booksReaderTtsVoice:focus-visible {
  outline: 2px solid #4a90d9;
  outline-offset: 1px;
}

/* TTS-F01: engine indicator badge */
.booksReaderTtsEngine {
  font-size: 9px;
  padding: 1px 5px;
  border-radius: 3px;
  background: rgba(100, 160, 255, 0.15);
  color: var(--muted);
  user-select: none;
  letter-spacing: 0.3px;
}
/* FIX-R05: TTS engine fallback indicator */
.booksReaderTtsEngine.ttsFallback {
  color: #f0a040;
  background: rgba(240, 160, 64, 0.15);
}

.booksReaderTtsSnippet {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--muted);
  font-size: 11px;
  padding-left: 8px;
}

.booksReaderTtsSnippet .ttsWord {
  color: var(--text, #e4e8ef);
  font-weight: 700;
}

/* TTS-F05: preset selector */
.booksReaderTtsPresetSel {
  font-size: 11px;
  max-width: 100px;
  padding: 2px 4px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 4px;
  background: rgba(30, 32, 40, 0.7);
  color: var(--muted);
  outline: none;
  cursor: pointer;
}
.booksReaderTtsPresetSel:focus-visible {
  outline: 2px solid #4a90d9;
  outline-offset: 1px;
}

/* FIX-R03: dark option background for TTS bar selects */
.booksReaderTtsPresetSel option,
.booksReaderTtsVoice option { background: #1a1c22; color: #e6e6e6; }

/* TTS-F08: diagnostics panel */
.booksReaderTtsDiag {
  position: absolute;
  bottom: 90px;
  right: 12px;
  width: 280px;
  background: rgba(24, 26, 34, 0.95);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 11px;
  color: var(--muted);
  z-index: 120;
  backdrop-filter: blur(8px);
}
.booksReaderTtsDiagHead {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  font-size: 12px;
  color: var(--text, #e4e8ef);
  margin-bottom: 6px;
}
.booksReaderTtsDiagHead .iconBtn {
  font-size: 11px;
  padding: 2px 4px;
}
.booksReaderTtsDiagBody {
  white-space: pre-wrap;
  font-family: monospace;
  font-size: 10px;
  line-height: 1.5;
}

/* WAVE4: active TTS block highlight */
.booksReaderTtsActive {
  background: rgba(100, 160, 255, 0.08) !important;
  border-radius: 3px;
}

/* WAVE4: TTS play button active state */
#booksReaderPlayBtn.ttsActive {
  color: #5ba3ff;
}

@media (max-width: 980px) {
  .booksReaderTtsBar {
    left: 8px;
    right: 8px;
    max-width: none;
    transform: none;
  }
}

/* ── R1: Persistent TTS launch button ──────────────────── */
.booksReaderTtsLaunch { font-size: 15px; opacity: 0.7; transition: opacity 0.15s, color 0.15s; }
.booksReaderTtsLaunch.ttsActive { opacity: 1; color: #4a90d9; }

/* ── R2: Toast notification ────────────────────────────── */
.booksReaderToast {
  position: absolute;
  top: 60px;
  left: 50%;
  transform: translateX(-50%) translateY(-8px);
  background: rgba(26, 28, 34, 0.92);
  color: #e0e0e0;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s, transform 0.2s;
  z-index: 60;
  backdrop-filter: blur(6px);
  white-space: nowrap;
  max-width: 90vw;
  overflow: hidden;
  text-overflow: ellipsis;
}
.booksReaderToast.visible {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* BUILD_OVERHAUL: TTS mini bar now styled in books-reader.css (inside footer) */
.booksTtsMiniBar.hidden { display: none !important; }
.booksTtsMiniBtn { font-size: 12px; min-width: 24px; }
.booksTtsMiniSnippet {
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--muted);
  font-size: 11px;
}
.booksTtsMiniSleep {
  font-size: 10px;
  min-width: 32px;
  text-align: center;
  color: var(--muted);
}
.booksTtsMiniSleep:not(:empty) { color: #e8a838; }

/* BUILD_OVERHAUL: old utility panel tabs removed — now sidebar */

/* ── R8: Richer scrub bubble ───────────────────────────── */
.scrubBubble.visible {
  opacity: 1 !important;
  transform: translateY(-4px) !important;
}

/* ── R9: Return to TTS location ────────────────────────── */
.booksReaderReturnTts {
  position: absolute;
  top: 56px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(26, 28, 34, 0.92);
  color: #a0c8ff;
  border: 1px solid rgba(74, 144, 217, 0.3);
  padding: 6px 14px;
  border-radius: 16px;
  font-size: 12px;
  cursor: pointer;
  z-index: 45;
  backdrop-filter: blur(6px);
  transition: opacity 0.2s;
}
.booksReaderReturnTts.hidden { display: none !important; }
.booksReaderReturnTts:hover { background: rgba(74, 144, 217, 0.25); }

/* ── R10: Empty/error states ───────────────────────────── */
.volNavEmpty {
  padding: 24px 16px;
  text-align: center;
  color: var(--muted);
  font-size: 13px;
}
.linkBtn {
  background: none;
  border: none;
  color: #4a90d9;
  cursor: pointer;
  text-decoration: underline;
  font-size: inherit;
  padding: 0;
}

/* R10: Books folder-level continue helper */
.booksFolderContinue { padding: 6px 12px; }
.booksFolderContinue.hidden { display: none !important; }
.booksFolderContinueInner {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 10px; background: var(--panel2); border: 1px solid var(--lib-border);
  border-radius: var(--lib-radius); cursor: pointer; font-size: var(--lib-font);
}
.booksFolderContinueInner:hover { background: rgba(255,255,255,.04); }
.booksFolderContinueLabel { color: var(--muted); white-space: nowrap; }
.booksFolderContinueTitle { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.booksFolderContinueBar { width: 60px; height: 3px; background: rgba(255,255,255,.1); border-radius: 2px; flex-shrink: 0; }
.booksFolderContinueFill { height: 100%; background: var(--accent); border-radius: 2px; }
.booksFolderContinueHint { color: var(--muted); font-size: 10px; min-width: 28px; text-align: right; }
.booksFolderContinueBtn { font-size: 11px; }

/* ══════════════════════════════════════════════════════════
   BUILD_HIST: Position history back/forward buttons
   ══════════════════════════════════════════════════════════ */
.booksHistBtn { font-size: 10px; opacity: 0.6; padding: 2px 4px; min-width: 20px; }
.booksHistBtn:not(:disabled):hover { opacity: 1; }
.booksHistBtn:disabled { opacity: 0.25; cursor: default; }

/* ══════════════════════════════════════════════════════════
   BUILD_CHAP: Chapter markers override for book reader scrubber
   ══════════════════════════════════════════════════════════ */
#booksReaderScrub .scrubChapterMark { width: 1px; background: rgba(255,255,255,0.3); }
#booksReaderScrub .scrubChapterMark:hover { background: rgba(255,255,255,0.6); }

/* ══════════════════════════════════════════════════════════
   BUILD_GOTO: Go-to-page dialog
   ══════════════════════════════════════════════════════════ */
.booksGotoOverlay {
  position: absolute; inset: 0; z-index: 65;
  display: flex; align-items: center; justify-content: center;
  background: rgba(0,0,0,0.5);
}
.booksGotoOverlay.hidden { display: none !important; }
.booksGotoCard {
  background: rgba(26,28,34,0.96); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px; padding: 16px 20px; min-width: 280px;
  backdrop-filter: blur(8px);
}
.booksGotoTitle { font-size: 14px; font-weight: 600; margin-bottom: 10px; }
.booksGotoCard .input { width: 100%; margin-bottom: 10px; }
.booksGotoActions { display: flex; gap: 8px; margin-bottom: 6px; }

/* ══════════════════════════════════════════════════════════
   BUILD_ANNOT: Annotation popup + panel
   ══════════════════════════════════════════════════════════ */
.booksAnnotPopup {
  position: absolute; z-index: 70;
  background: rgba(26,28,34,0.96); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px; padding: 12px; min-width: 240px; max-width: 320px;
  backdrop-filter: blur(8px);
}
.booksAnnotPopup.hidden { display: none !important; }
.booksAnnotPopupHead { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.booksAnnotPopupTitle { font-size: 13px; font-weight: 600; }
.booksAnnotColors { display: flex; gap: 6px; margin-bottom: 8px; }
.booksAnnotColorSwatch {
  width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
  border: 2px solid transparent; transition: border-color 0.15s;
}
.booksAnnotColorSwatch:hover { border-color: rgba(255,255,255,0.4); }
.booksAnnotColorSwatch.active { border-color: #fff; }
.booksAnnotStyles { display: flex; gap: 6px; margin-bottom: 8px; }
.booksAnnotStyleBtn {
  padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer;
  background: rgba(255,255,255,0.06); color: var(--text,#e4e8ef); border: 1px solid transparent;
  transition: border-color 0.15s, background 0.15s;
}
.booksAnnotStyleBtn:hover { background: rgba(255,255,255,0.1); }
.booksAnnotStyleBtn.active { border-color: rgba(255,255,255,0.4); background: rgba(255,255,255,0.12); }
.booksAnnotNote {
  width: 100%; background: rgba(255,255,255,0.05); color: var(--text,#e4e8ef);
  border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;
  padding: 6px 8px; font-size: 12px; resize: vertical; margin-bottom: 8px;
  font-family: inherit;
}
.booksAnnotActions { display: flex; gap: 8px; }

/* Annotation list items in utility panel */
.booksAnnotItem {
  display: flex; flex-direction: column; gap: 2px;
  padding: 8px 10px; cursor: pointer; border-radius: 4px;
  transition: background 0.15s;
}
.booksAnnotItem:hover { background: rgba(255,255,255,0.04); }
.booksAnnotItemText {
  font-size: 12px; line-height: 1.4;
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  overflow: hidden; text-overflow: ellipsis;
}
.booksAnnotItemSwatch {
  display: inline-block; width: 10px; height: 10px; border-radius: 50%;
  margin-right: 4px; vertical-align: middle;
}
.booksAnnotItemNote {
  font-size: 11px; color: var(--muted,#888); font-style: italic;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.booksAnnotItemMeta { font-size: 10px; color: var(--muted,#888); }

/* ══════════════════════════════════════════════════════════
   BUILD_TTSH: TTS sentence + word highlighting (non-iframe / TXT reader)
   ══════════════════════════════════════════════════════════ */
.booksReaderTtsSentence {
  background: rgba(100,160,255,0.18) !important;
  border-radius: 2px;
}
.booksReaderTtsWord {
  background: rgba(90,150,255,0.45) !important;
  border-radius: 2px; padding: 0 1px;
}
